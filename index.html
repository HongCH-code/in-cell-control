<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>In Cell Parameter Setting</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    html { scroll-behavior: smooth; }

    /* Modal backdrop */
    .modal-backdrop {
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: #F1F5F9;
      border-radius: 3px;
    }
    ::-webkit-scrollbar-thumb {
      background: #CBD5E1;
      border-radius: 3px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #94A3B8;
    }

    /* Number input arrows */
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      opacity: 1;
      height: 32px;
    }
  </style>
</head>
<body class="bg-slate-100 min-h-screen">

  <!-- Main Container -->
  <div class="max-w-5xl mx-auto p-4 sm:p-6 lg:p-8">

    <!-- Header -->
    <header class="mb-6 text-center">
      <h1 class="text-2xl font-bold text-slate-900">In Cell Parameter Setting</h1>
      <p class="text-slate-600 mt-1">Configure AC Timing, DC Electrical, and Programmable Gain settings</p>
    </header>

    <!-- Serial Port Connection -->
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-6">
      <div class="px-6 py-4 flex flex-wrap items-center gap-4">
        <div class="flex items-center gap-2">
          <svg class="w-5 h-5 text-slate-500" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
          </svg>
          <span class="text-sm font-medium text-slate-700">Serial Port</span>
        </div>

        <!-- Port Selector -->
        <div class="flex items-center gap-2">
          <label for="port-select" class="text-sm text-slate-600">Port:</label>
          <select id="port-select" class="h-9 px-3 border border-slate-300 rounded-lg text-sm text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary cursor-pointer">
            <option value="">Select Port</option>
          </select>
          <button id="refresh-ports-btn" type="button" class="h-9 w-9 flex items-center justify-center border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors cursor-pointer" aria-label="Refresh ports">
            <svg class="w-4 h-4 text-slate-600" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
          </button>
        </div>

        <!-- Baud Rate Selector -->
        <div class="flex items-center gap-2">
          <label for="baudrate-select" class="text-sm text-slate-600">Baud Rate:</label>
          <select id="baudrate-select" class="h-9 px-3 border border-slate-300 rounded-lg text-sm text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary cursor-pointer">
            <option value="9600">9600</option>
            <option value="19200">19200</option>
            <option value="38400">38400</option>
            <option value="57600">57600</option>
            <option value="115200" selected>115200</option>
            <option value="230400">230400</option>
            <option value="460800">460800</option>
            <option value="921600">921600</option>
          </select>
        </div>

        <!-- Connect/Disconnect Button -->
        <button id="connect-btn" type="button" class="h-9 px-4 text-sm font-medium text-white bg-green-500 rounded-lg hover:bg-green-600 transition-colors cursor-pointer">
          Connect
        </button>

        <!-- Status Indicator -->
        <div class="flex items-center gap-2 ml-auto">
          <div id="status-dot" class="w-3 h-3 rounded-full bg-slate-300"></div>
          <span id="status-text" class="text-sm text-slate-600">Disconnected</span>
        </div>
      </div>
    </div>

    <!-- Settings Card -->
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">

      <!-- Tab Navigation -->
      <nav class="flex border-b border-slate-200" role="tablist">
        <button
          id="tab-ac-timing"
          class="tab-btn flex-1 px-4 py-4 text-sm font-medium transition-colors duration-200 border-b-2 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-inset"
          role="tab"
          aria-selected="true"
          aria-controls="panel-ac-timing"
          data-tab="ac-timing"
        >
          AC Timing
        </button>
        <button
          id="tab-dc-electrical"
          class="tab-btn flex-1 px-4 py-4 text-sm font-medium transition-colors duration-200 border-b-2 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-inset"
          role="tab"
          aria-selected="false"
          aria-controls="panel-dc-electrical"
          data-tab="dc-electrical"
        >
          DC Electrical
        </button>
        <button
          id="tab-programmable-gain"
          class="tab-btn flex-1 px-4 py-4 text-sm font-medium transition-colors duration-200 border-b-2 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-inset"
          role="tab"
          aria-selected="false"
          aria-controls="panel-programmable-gain"
          data-tab="programmable-gain"
        >
          Programmable Gain Setting
        </button>
      </nav>

      <!-- Tab Panels -->
      <div class="p-6">

        <!-- AC Timing Panel -->
        <div
          id="panel-ac-timing"
          class="tab-panel"
          role="tabpanel"
          aria-labelledby="tab-ac-timing"
        >
          <div class="space-y-8">

            <!-- Sensor Section -->
            <section>
              <h3 class="text-lg font-semibold text-slate-800 mb-4 flex items-center">
                <svg class="w-5 h-5 mr-2 text-primary" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/>
                </svg>
                Sensor
              </h3>
              <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4">
                <div class="space-y-2">
                  <label for="sensor-t1" class="block text-sm font-medium text-slate-700">T1</label>
                  <input type="number" id="sensor-t1" name="sensor-t1"
                    class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                    min="0" max="255" placeholder="0">
                </div>
                <div class="space-y-2">
                  <label for="sensor-t2" class="block text-sm font-medium text-slate-700">T2</label>
                  <input type="number" id="sensor-t2" name="sensor-t2"
                    class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                    min="0" max="255" placeholder="0">
                </div>
                <div class="space-y-2">
                  <label for="sensor-t3" class="block text-sm font-medium text-slate-700">T3</label>
                  <input type="number" id="sensor-t3" name="sensor-t3"
                    class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                    min="0" max="255" placeholder="0">
                </div>
                <div class="space-y-2">
                  <label for="sensor-t4" class="block text-sm font-medium text-slate-700">T4</label>
                  <input type="number" id="sensor-t4" name="sensor-t4"
                    class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                    min="0" max="255" placeholder="0">
                </div>
                <div class="space-y-2">
                  <label for="sensor-t5" class="block text-sm font-medium text-slate-700">T5</label>
                  <input type="number" id="sensor-t5" name="sensor-t5"
                    class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                    min="0" max="255" placeholder="0">
                </div>
              </div>
            </section>

            <!-- Heater Section -->
            <section>
              <h3 class="text-lg font-semibold text-slate-800 mb-4 flex items-center">
                <svg class="w-5 h-5 mr-2 text-orange-500" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z"/>
                </svg>
                Heater
              </h3>
              <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-4">
                <div class="space-y-2">
                  <label for="heater-tsw1b" class="block text-sm font-medium text-slate-700">TSW1b</label>
                  <input type="number" id="heater-tsw1b" name="heater-tsw1b"
                    class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                    min="0" max="255" placeholder="0">
                </div>
                <div class="space-y-2">
                  <label for="heater-tsw2b" class="block text-sm font-medium text-slate-700">TSW2b</label>
                  <input type="number" id="heater-tsw2b" name="heater-tsw2b"
                    class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                    min="0" max="255" placeholder="0">
                </div>
                <div class="space-y-2">
                  <label for="heater-tsw3b" class="block text-sm font-medium text-slate-700">TSW3b</label>
                  <input type="number" id="heater-tsw3b" name="heater-tsw3b"
                    class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                    min="0" max="255" placeholder="0">
                </div>
                <div class="space-y-2">
                  <label for="heater-tsw3a" class="block text-sm font-medium text-slate-700">TSW3a</label>
                  <input type="number" id="heater-tsw3a" name="heater-tsw3a"
                    class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                    min="0" max="255" placeholder="0">
                </div>
                <div class="space-y-2">
                  <label for="heater-tsw2a" class="block text-sm font-medium text-slate-700">TSW2a</label>
                  <input type="number" id="heater-tsw2a" name="heater-tsw2a"
                    class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                    min="0" max="255" placeholder="0">
                </div>
                <div class="space-y-2">
                  <label for="heater-tsw1a" class="block text-sm font-medium text-slate-700">TSW1a</label>
                  <input type="number" id="heater-tsw1a" name="heater-tsw1a"
                    class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                    min="0" max="255" placeholder="0">
                </div>
              </div>
            </section>

          </div>
        </div>

        <!-- DC Electrical Panel -->
        <div
          id="panel-dc-electrical"
          class="tab-panel hidden"
          role="tabpanel"
          aria-labelledby="tab-dc-electrical"
        >
          <div class="space-y-8">

            <!-- PMIC Section -->
            <section>
              <h3 class="text-lg font-semibold text-slate-800 mb-4 flex items-center">
                <svg class="w-5 h-5 mr-2 text-yellow-500" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
                PMIC
              </h3>
              <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-2 gap-4 max-w-md">
                <div class="space-y-2">
                  <label for="pmic-vd" class="block text-sm font-medium text-slate-700">VD</label>
                  <input type="number" id="pmic-vd" name="pmic-vd"
                    class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                    min="0" max="255" placeholder="0">
                </div>
                <div class="space-y-2">
                  <label for="pmic-vg" class="block text-sm font-medium text-slate-700">VG</label>
                  <input type="number" id="pmic-vg" name="pmic-vg"
                    class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                    min="0" max="255" placeholder="0">
                </div>
              </div>
            </section>

          </div>
        </div>

        <!-- Programmable Gain Setting Panel -->
        <div
          id="panel-programmable-gain"
          class="tab-panel hidden"
          role="tabpanel"
          aria-labelledby="tab-programmable-gain"
        >
          <div class="space-y-6">

            <!-- Digital Potentiometer Section -->
            <section>
              <h3 class="text-lg font-semibold text-slate-800 mb-4 flex items-center">
                <svg class="w-5 h-5 mr-2 text-purple-500" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
                </svg>
                Digital Potentiometer
              </h3>

              <!-- CS Tabs -->
              <div class="border border-slate-200 rounded-xl overflow-hidden">
                <nav class="flex bg-slate-50 border-b border-slate-200" role="tablist">
                  <button class="cs-tab-btn flex-1 px-3 py-3 text-sm font-medium transition-colors duration-200 border-b-2 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-inset" role="tab" aria-selected="true" data-cs-tab="cs0">CS0</button>
                  <button class="cs-tab-btn flex-1 px-3 py-3 text-sm font-medium transition-colors duration-200 border-b-2 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-inset" role="tab" aria-selected="false" data-cs-tab="cs1">CS1</button>
                  <button class="cs-tab-btn flex-1 px-3 py-3 text-sm font-medium transition-colors duration-200 border-b-2 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-inset" role="tab" aria-selected="false" data-cs-tab="cs2">CS2</button>
                  <button class="cs-tab-btn flex-1 px-3 py-3 text-sm font-medium transition-colors duration-200 border-b-2 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-inset" role="tab" aria-selected="false" data-cs-tab="cs3">CS3</button>
                  <button class="cs-tab-btn flex-1 px-3 py-3 text-sm font-medium transition-colors duration-200 border-b-2 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-inset" role="tab" aria-selected="false" data-cs-tab="cs4">CS4</button>
                  <button class="cs-tab-btn flex-1 px-3 py-3 text-sm font-medium transition-colors duration-200 border-b-2 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-inset" role="tab" aria-selected="false" data-cs-tab="cs5">CS5</button>
                </nav>

                <!-- CS Panels -->
                <div class="p-4">
                  <!-- CS0 Panel -->
                  <div class="cs-panel" data-cs-panel="cs0">
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                      <div class="space-y-2">
                        <label for="cs0-wiper0" class="block text-sm font-medium text-slate-700">Wiper0</label>
                        <input type="number" id="cs0-wiper0" name="cs0-wiper0"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs0-wiper1" class="block text-sm font-medium text-slate-700">Wiper1</label>
                        <input type="number" id="cs0-wiper1" name="cs0-wiper1"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs0-wiper2" class="block text-sm font-medium text-slate-700">Wiper2</label>
                        <input type="number" id="cs0-wiper2" name="cs0-wiper2"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs0-wiper3" class="block text-sm font-medium text-slate-700">Wiper3</label>
                        <input type="number" id="cs0-wiper3" name="cs0-wiper3"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                    </div>
                  </div>

                  <!-- CS1 Panel -->
                  <div class="cs-panel hidden" data-cs-panel="cs1">
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                      <div class="space-y-2">
                        <label for="cs1-wiper0" class="block text-sm font-medium text-slate-700">Wiper0</label>
                        <input type="number" id="cs1-wiper0" name="cs1-wiper0"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs1-wiper1" class="block text-sm font-medium text-slate-700">Wiper1</label>
                        <input type="number" id="cs1-wiper1" name="cs1-wiper1"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs1-wiper2" class="block text-sm font-medium text-slate-700">Wiper2</label>
                        <input type="number" id="cs1-wiper2" name="cs1-wiper2"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs1-wiper3" class="block text-sm font-medium text-slate-700">Wiper3</label>
                        <input type="number" id="cs1-wiper3" name="cs1-wiper3"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                    </div>
                  </div>

                  <!-- CS2 Panel -->
                  <div class="cs-panel hidden" data-cs-panel="cs2">
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                      <div class="space-y-2">
                        <label for="cs2-wiper0" class="block text-sm font-medium text-slate-700">Wiper0</label>
                        <input type="number" id="cs2-wiper0" name="cs2-wiper0"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs2-wiper1" class="block text-sm font-medium text-slate-700">Wiper1</label>
                        <input type="number" id="cs2-wiper1" name="cs2-wiper1"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs2-wiper2" class="block text-sm font-medium text-slate-700">Wiper2</label>
                        <input type="number" id="cs2-wiper2" name="cs2-wiper2"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs2-wiper3" class="block text-sm font-medium text-slate-700">Wiper3</label>
                        <input type="number" id="cs2-wiper3" name="cs2-wiper3"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                    </div>
                  </div>

                  <!-- CS3 Panel -->
                  <div class="cs-panel hidden" data-cs-panel="cs3">
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                      <div class="space-y-2">
                        <label for="cs3-wiper0" class="block text-sm font-medium text-slate-700">Wiper0</label>
                        <input type="number" id="cs3-wiper0" name="cs3-wiper0"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs3-wiper1" class="block text-sm font-medium text-slate-700">Wiper1</label>
                        <input type="number" id="cs3-wiper1" name="cs3-wiper1"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs3-wiper2" class="block text-sm font-medium text-slate-700">Wiper2</label>
                        <input type="number" id="cs3-wiper2" name="cs3-wiper2"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs3-wiper3" class="block text-sm font-medium text-slate-700">Wiper3</label>
                        <input type="number" id="cs3-wiper3" name="cs3-wiper3"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                    </div>
                  </div>

                  <!-- CS4 Panel -->
                  <div class="cs-panel hidden" data-cs-panel="cs4">
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                      <div class="space-y-2">
                        <label for="cs4-wiper0" class="block text-sm font-medium text-slate-700">Wiper0</label>
                        <input type="number" id="cs4-wiper0" name="cs4-wiper0"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs4-wiper1" class="block text-sm font-medium text-slate-700">Wiper1</label>
                        <input type="number" id="cs4-wiper1" name="cs4-wiper1"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs4-wiper2" class="block text-sm font-medium text-slate-700">Wiper2</label>
                        <input type="number" id="cs4-wiper2" name="cs4-wiper2"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs4-wiper3" class="block text-sm font-medium text-slate-700">Wiper3</label>
                        <input type="number" id="cs4-wiper3" name="cs4-wiper3"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                    </div>
                  </div>

                  <!-- CS5 Panel -->
                  <div class="cs-panel hidden" data-cs-panel="cs5">
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                      <div class="space-y-2">
                        <label for="cs5-wiper0" class="block text-sm font-medium text-slate-700">Wiper0</label>
                        <input type="number" id="cs5-wiper0" name="cs5-wiper0"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs5-wiper1" class="block text-sm font-medium text-slate-700">Wiper1</label>
                        <input type="number" id="cs5-wiper1" name="cs5-wiper1"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs5-wiper2" class="block text-sm font-medium text-slate-700">Wiper2</label>
                        <input type="number" id="cs5-wiper2" name="cs5-wiper2"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                      <div class="space-y-2">
                        <label for="cs5-wiper3" class="block text-sm font-medium text-slate-700">Wiper3</label>
                        <input type="number" id="cs5-wiper3" name="cs5-wiper3"
                          class="w-full h-10 px-3 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-primary focus:border-primary transition-colors duration-200"
                          min="0" max="255" placeholder="0">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </section>

          </div>
        </div>

      </div>

      <!-- Action Buttons -->
      <div class="px-6 py-4 bg-slate-50 border-t border-slate-200 flex justify-end gap-3">
        <button
          id="reset-btn"
          type="button"
          class="px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors duration-200 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-primary"
        >
          Reset
        </button>
        <button
          id="apply-btn"
          type="button"
          class="px-4 py-2 text-sm font-medium text-white bg-primary rounded-lg hover:bg-blue-600 transition-colors duration-200 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2"
        >
          Apply Settings
        </button>
      </div>
    </div>

    <!-- Timing Diagram Section -->
    <section class="mt-8">
      <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
        <div class="px-6 py-4 border-b border-slate-200 flex items-center justify-between">
          <h2 class="text-lg font-semibold text-slate-800 flex items-center">
            <svg class="w-5 h-5 mr-2 text-slate-500" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
            </svg>
            Timing Diagram
          </h2>
          <button
            id="expand-timing-btn"
            type="button"
            class="flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-slate-600 bg-slate-100 rounded-lg hover:bg-slate-200 transition-colors duration-200 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-primary"
            aria-label="Expand timing diagram"
          >
            <svg class="w-4 h-4" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"/>
            </svg>
            Expand
          </button>
        </div>
        <div class="p-4">
          <div class="overflow-auto rounded-lg border border-slate-200 bg-slate-50">
            <img
              src="Timing.png"
              alt="Timing diagram showing AC timing waveforms for Sensor and Heater signals"
              class="w-full min-w-[600px] h-auto cursor-zoom-in"
              id="timing-image"
              loading="lazy"
            >
          </div>
        </div>
      </div>
    </section>

  </div>

  <!-- Image Modal -->
  <div id="image-modal" class="fixed inset-0 z-50 hidden modal-backdrop">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="relative max-w-[95vw] max-h-[95vh]">
        <button
          id="close-modal-btn"
          type="button"
          class="absolute -top-12 right-0 flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-slate-800/80 rounded-lg hover:bg-slate-700 transition-colors duration-200 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-white"
          aria-label="Close modal"
        >
          <svg class="w-5 h-5" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
          Close (Esc)
        </button>
        <img
          src="Timing.png"
          alt="Timing diagram (enlarged)"
          class="max-w-full max-h-[85vh] rounded-lg shadow-2xl bg-white"
          id="modal-image"
        >
      </div>
    </div>
  </div>

  <script>
    // Main Tab Navigation
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabPanels = document.querySelectorAll('.tab-panel');

    function setActiveTab(tabId) {
      // Update tab buttons
      tabBtns.forEach(btn => {
        const isActive = btn.dataset.tab === tabId;
        btn.setAttribute('aria-selected', isActive);
        btn.classList.toggle('text-primary', isActive);
        btn.classList.toggle('border-primary', isActive);
        btn.classList.toggle('text-slate-600', !isActive);
        btn.classList.toggle('border-transparent', !isActive);
        btn.classList.toggle('hover:text-slate-800', !isActive);
        btn.classList.toggle('hover:border-slate-300', !isActive);
      });

      // Update tab panels
      tabPanels.forEach(panel => {
        const isActive = panel.id === `panel-${tabId}`;
        panel.classList.toggle('hidden', !isActive);
      });
    }

    tabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        setActiveTab(btn.dataset.tab);
      });
    });

    // Initialize first tab
    setActiveTab('ac-timing');

    // CS Tab Navigation (for Programmable Gain Setting)
    const csTabBtns = document.querySelectorAll('.cs-tab-btn');
    const csPanels = document.querySelectorAll('.cs-panel');

    function setActiveCsTab(csId) {
      // Update CS tab buttons
      csTabBtns.forEach(btn => {
        const isActive = btn.dataset.csTab === csId;
        btn.setAttribute('aria-selected', isActive);
        btn.classList.toggle('text-primary', isActive);
        btn.classList.toggle('border-primary', isActive);
        btn.classList.toggle('bg-white', isActive);
        btn.classList.toggle('text-slate-600', !isActive);
        btn.classList.toggle('border-transparent', !isActive);
        btn.classList.toggle('hover:text-slate-800', !isActive);
      });

      // Update CS panels
      csPanels.forEach(panel => {
        const isActive = panel.dataset.csPanel === csId;
        panel.classList.toggle('hidden', !isActive);
      });
    }

    csTabBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        setActiveCsTab(btn.dataset.csTab);
      });
    });

    // Initialize first CS tab
    setActiveCsTab('cs0');

    // Image Modal
    const expandBtn = document.getElementById('expand-timing-btn');
    const timingImage = document.getElementById('timing-image');
    const imageModal = document.getElementById('image-modal');
    const closeModalBtn = document.getElementById('close-modal-btn');

    function openModal() {
      imageModal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      imageModal.classList.add('hidden');
      document.body.style.overflow = '';
    }

    expandBtn.addEventListener('click', openModal);
    timingImage.addEventListener('click', openModal);
    closeModalBtn.addEventListener('click', closeModal);

    // Close modal on backdrop click
    imageModal.addEventListener('click', (e) => {
      if (e.target === imageModal) {
        closeModal();
      }
    });

    // Close modal on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !imageModal.classList.contains('hidden')) {
        closeModal();
      }
    });

    // Input Validation (0-255 range)
    const allInputs = document.querySelectorAll('input[type="number"]');

    function validateInput(input) {
      const value = input.value;
      const numValue = parseFloat(value);

      // Check if value is out of range or invalid
      const isInvalid = value !== '' && (isNaN(numValue) || numValue < 0 || numValue > 255 || !Number.isInteger(numValue));

      if (isInvalid) {
        input.classList.remove('text-slate-900');
        input.classList.add('text-red-500', 'border-red-400');
      } else {
        input.classList.remove('text-red-500', 'border-red-400');
        input.classList.add('text-slate-900');
      }
    }

    // Add validation listeners to all inputs
    allInputs.forEach(input => {
      input.addEventListener('input', () => validateInput(input));
      input.addEventListener('change', () => validateInput(input));
    });

    // Reset Button - Clear all fields
    const resetBtn = document.getElementById('reset-btn');

    resetBtn.addEventListener('click', () => {
      allInputs.forEach(input => {
        input.value = '';
        input.classList.remove('text-red-500', 'border-red-400');
        input.classList.add('text-slate-900');
      });
    });

    // Serial Port Connection
    const portSelect = document.getElementById('port-select');
    const baudrateSelect = document.getElementById('baudrate-select');
    const refreshPortsBtn = document.getElementById('refresh-ports-btn');
    const connectBtn = document.getElementById('connect-btn');
    const statusDot = document.getElementById('status-dot');
    const statusText = document.getElementById('status-text');
    const applyBtn = document.getElementById('apply-btn');

    let isConnected = false;

    // Refresh available ports
    async function refreshPorts() {
      if (!window.serialAPI) {
        console.log('Serial API not available (running in browser)');
        return;
      }

      const result = await window.serialAPI.listPorts();
      if (result.success) {
        portSelect.innerHTML = '<option value="">Select Port</option>';
        result.ports.forEach(port => {
          const option = document.createElement('option');
          option.value = port.path;
          option.textContent = port.path + (port.manufacturer ? ` (${port.manufacturer})` : '');
          portSelect.appendChild(option);
        });
      }
    }

    // Update UI based on connection status
    function updateConnectionUI(connected, portPath = '', baudRate = '') {
      isConnected = connected;
      if (connected) {
        statusDot.classList.remove('bg-slate-300');
        statusDot.classList.add('bg-green-500');
        statusText.textContent = `Connected: ${portPath} @ ${baudRate}`;
        statusText.classList.remove('text-slate-600');
        statusText.classList.add('text-green-600');
        connectBtn.textContent = 'Disconnect';
        connectBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
        connectBtn.classList.add('bg-red-500', 'hover:bg-red-600');
        portSelect.disabled = true;
        baudrateSelect.disabled = true;
      } else {
        statusDot.classList.remove('bg-green-500');
        statusDot.classList.add('bg-slate-300');
        statusText.textContent = 'Disconnected';
        statusText.classList.remove('text-green-600');
        statusText.classList.add('text-slate-600');
        connectBtn.textContent = 'Connect';
        connectBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
        connectBtn.classList.add('bg-green-500', 'hover:bg-green-600');
        portSelect.disabled = false;
        baudrateSelect.disabled = false;
      }
    }

    // Connect/Disconnect handler
    connectBtn.addEventListener('click', async () => {
      if (!window.serialAPI) {
        alert('Serial API not available. Please run in Electron app.');
        return;
      }

      if (isConnected) {
        // Disconnect
        const result = await window.serialAPI.disconnect();
        if (result.success) {
          updateConnectionUI(false);
        } else {
          alert('Failed to disconnect: ' + result.error);
        }
      } else {
        // Connect
        const port = portSelect.value;
        const baudRate = baudrateSelect.value;

        if (!port) {
          alert('Please select a port');
          return;
        }

        const result = await window.serialAPI.connect(port, baudRate);
        if (result.success) {
          updateConnectionUI(true, port, baudRate);
        } else {
          alert('Failed to connect: ' + result.error);
        }
      }
    });

    // Refresh ports button
    refreshPortsBtn.addEventListener('click', refreshPorts);

    // Listen for status changes from main process
    if (window.serialAPI) {
      window.serialAPI.onStatusChange((status) => {
        updateConnectionUI(status.connected, status.port, status.baudRate);
      });

      window.serialAPI.onError((error) => {
        alert('Serial error: ' + error);
        updateConnectionUI(false);
      });

      // Initial port refresh
      refreshPorts();
    }

    // Collect all settings data
    function collectSettingsData() {
      const data = {
        acTiming: {
          sensor: {
            T1: parseInt(document.getElementById('sensor-t1').value) || 0,
            T2: parseInt(document.getElementById('sensor-t2').value) || 0,
            T3: parseInt(document.getElementById('sensor-t3').value) || 0,
            T4: parseInt(document.getElementById('sensor-t4').value) || 0,
            T5: parseInt(document.getElementById('sensor-t5').value) || 0
          },
          heater: {
            TSW1b: parseInt(document.getElementById('heater-tsw1b').value) || 0,
            TSW2b: parseInt(document.getElementById('heater-tsw2b').value) || 0,
            TSW3b: parseInt(document.getElementById('heater-tsw3b').value) || 0,
            TSW3a: parseInt(document.getElementById('heater-tsw3a').value) || 0,
            TSW2a: parseInt(document.getElementById('heater-tsw2a').value) || 0,
            TSW1a: parseInt(document.getElementById('heater-tsw1a').value) || 0
          }
        },
        dcElectrical: {
          pmic: {
            VD: parseInt(document.getElementById('pmic-vd').value) || 0,
            VG: parseInt(document.getElementById('pmic-vg').value) || 0
          }
        },
        programmableGain: {
          digitalPotentiometer: {}
        }
      };

      // Collect CS0-CS5 Wiper data
      for (let cs = 0; cs <= 5; cs++) {
        data.programmableGain.digitalPotentiometer[`CS${cs}`] = {
          Wiper0: parseInt(document.getElementById(`cs${cs}-wiper0`).value) || 0,
          Wiper1: parseInt(document.getElementById(`cs${cs}-wiper1`).value) || 0,
          Wiper2: parseInt(document.getElementById(`cs${cs}-wiper2`).value) || 0,
          Wiper3: parseInt(document.getElementById(`cs${cs}-wiper3`).value) || 0
        };
      }

      return data;
    }

    // Apply Settings Button - Send data via Serial Port
    applyBtn.addEventListener('click', async () => {
      // Check for validation errors
      let hasErrors = false;
      allInputs.forEach(input => {
        if (input.classList.contains('text-red-500')) {
          hasErrors = true;
        }
      });

      if (hasErrors) {
        alert('Please fix invalid values (must be 0-255) before applying settings.');
        return;
      }

      if (!window.serialAPI) {
        // Running in browser - just show the data
        const data = collectSettingsData();
        console.log('Settings data:', data);
        alert('Serial API not available. Settings data logged to console.');
        return;
      }

      if (!isConnected) {
        alert('Please connect to a serial port first.');
        return;
      }

      // Collect and send data
      const data = collectSettingsData();
      const jsonData = JSON.stringify(data);

      const result = await window.serialAPI.send(jsonData + '\n');
      if (result.success) {
        alert('Settings sent successfully!');
      } else {
        alert('Failed to send settings: ' + result.error);
      }
    });
  </script>

</body>
</html>
